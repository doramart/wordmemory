import{A as e,F as t,G as n,J as r,K as i,M as a,Q as o,U as s,W as c,Y as l,at as u,ct as d,et as f,g as p,it as m,j as h,m as g,o as ee,ot as _,q as v,rt as y,st as b,v as x,z as S}from"./vue-qqQgwo1J.js";import"./vendor-BZARPbSw.js";import{t as C}from"./index-DngR5WJL.js";import{t as w}from"./useStudyMode-Cc2-78KI.js";import{i as T,n as E,t as te}from"./wordmemory-UTo84tZV.js";var ne={class:`container learn-container`},re={class:`loading-wrapper`,key:`loading`},ie={class:`empty-wrapper`,key:`empty`},ae={class:`empty-actions`},D={class:`card-inner`},O={key:0,class:`word-image-container`},k={class:`image-error`},A={key:1,class:`word-image-placeholder`},j={class:`word-content`},M={key:0,class:`word-header`},N={class:`word-title`},P={key:1,class:`phonetic-tag`},F={key:2,class:`meaning-box`},I={key:3,class:`example-box`},L={class:`example-text`},R={class:`controls`},z={class:`secondary-controls`},B={class:`progress-section`},V={class:`progress-text`},H=C({__name:`WordLearn`,setup(C){let H=t(),U=u([]),W=u(0),G=u(null),K=u(!0),q=u(!1),J=u(!1),Y=u(!1),{showImage:oe,showWord:se,showMeaning:ce,showPhonetic:X,showExample:le}=w(),ue=s(()=>U.value.length===0?0:(W.value+1)/U.value.length*100),de=e=>{if(!e||!U.value.length)return;let t=U.value.findIndex(t=>t._id===e);t!==-1&&(W.value=t,G.value=U.value[t])},fe=async()=>{try{K.value=!0;let[e,t]=await Promise.all([T.getAll(),E.getAll()]),n=e.data||[];Y.value=n.length>0;let r=new Map((t.data||[]).map(e=>[e.wordId._id||e.wordId,e])),i=H.query.wordId,a=n.filter(e=>{if(i&&e._id===i)return!0;let t=r.get(e._id);return!t||t.status!==`passed`});if(a.sort((e,t)=>{if(i){if(e._id===i)return-1;if(t._id===i)return 1}let n=r.get(e._id),a=r.get(t._id),o=n?.status===`failed`,s=a?.status===`failed`;return o&&!s?-1:!o&&s?1:0}),U.value=a,U.value.length>0)if(i){let e=U.value.findIndex(e=>e._id===i);e===-1?G.value=U.value[0]:(W.value=e,G.value=U.value[e])}else G.value=U.value[0];else G.value=null}catch(e){console.error(`Failed to load words:`,e),x(e.message||`åŠ è½½å•è¯å¤±è´¥`)}finally{K.value=!1}},Z=()=>{U.value.length&&(W.value<U.value.length-1?W.value++:W.value=0,G.value=U.value[W.value])},pe=()=>{U.value.length&&(W.value>0?W.value--:W.value=U.value.length-1,G.value=U.value[W.value])},Q=async e=>{try{await E.update(G.value._id,{status:e}),Z()}catch(e){console.error(`Failed to update progress:`,e),x(`æ›´æ–°è¿›åº¦å¤±è´¥`)}},$=async()=>{await Q(`passed`)},me=async()=>{J.value=!0,setTimeout(()=>{J.value=!1},500),await Q(`failed`)};y(()=>H.query.wordId,e=>{e&&de(e)});let he=async()=>{try{q.value=!0;let e=await te.generate(G.value._id);G.value.imageUrl=e.data?.imageUrl}catch(e){console.error(`Failed to generate image:`,e),x(e.response?.data?.details||`ç”Ÿæˆå›¾ç‰‡å¤±è´¥`)}finally{q.value=!1}},ge=()=>{if(`speechSynthesis`in window){let e=new SpeechSynthesisUtterance(G.value.word);e.lang=`en-US`,e.rate=.8,window.speechSynthesis.speak(e)}else alert(`æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒè¯­éŸ³åŠŸèƒ½`)},_e=async()=>{if(confirm(`ç¡®å®šè¦é‡ç½®æ‰€æœ‰å­¦ä¹ è¿›åº¦å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`))try{K.value=!0,await E.resetAll(),window.location.reload()}catch(e){console.error(`Failed to reset progress:`,e),x(e.response?.data?.error||`é‡ç½®å¤±è´¥`),K.value=!1}};return o(()=>{fe()}),(t,o)=>{let s=h,u=e,y=g,x=a,C=p,w=ee;return f(),v(`div`,ne,[l(S,{name:`fade`,mode:`out-in`},{default:m(()=>[K.value?(f(),v(`div`,re,[l(s,{vertical:``,color:`#1989fa`,size:`24px`},{default:m(()=>[...o[0]||=[r(`å‡†å¤‡å•è¯ä¸­...`,-1)]]),_:1})])):G.value?(f(),v(`div`,{class:b([`card word-card`,{"shake-animation":J.value}]),key:`card`},[c(`div`,D,[_(oe)?(f(),v(`div`,O,[G.value.imageUrl?(f(),n(C,{key:0,fit:`cover`,width:`100%`,height:`100%`,src:G.value.imageUrl,class:`word-image`},{loading:m(()=>[l(s,{type:`spinner`,size:`20`})]),error:m(()=>[c(`div`,k,[l(x,{name:`photo-fail`,size:`30`,color:`#dcdee0`}),o[3]||=c(`span`,null,`åŠ è½½å¤±è´¥`,-1)])]),_:1},8,[`src`])):(f(),v(`div`,A,[l(x,{name:`photo-o`,size:`40`,color:`#dcdee0`}),o[4]||=c(`span`,{class:`placeholder-text`},`æš‚æ— å›¾ç‰‡`,-1)])),l(u,{round:``,class:`generate-btn`,loading:q.value,onClick:he,size:`small`},{icon:m(()=>[...o[5]||=[c(`span`,{style:{"font-size":`16px`}},`ğŸ¨`,-1)]]),_:1},8,[`loading`])])):i(``,!0),c(`div`,j,[_(se)?(f(),v(`div`,M,[c(`h1`,N,d(G.value.word),1),_(X)&&G.value.phonetic?(f(),n(u,{key:0,round:``,size:`small`,color:`var(--accent-color)`,class:`audio-btn`,onClick:ge},{icon:m(()=>[...o[6]||=[r(`ğŸ”Š`,-1)]]),_:1})):i(``,!0)])):i(``,!0),_(X)&&G.value.phonetic?(f(),v(`div`,P,d(G.value.phonetic),1)):i(``,!0),_(ce)&&G.value.meaning?(f(),v(`div`,F,d(G.value.meaning),1)):i(``,!0),_(le)&&G.value.example?(f(),v(`div`,I,[c(`p`,L,d(G.value.example),1)])):i(``,!0)])]),c(`div`,R,[l(u,{type:`danger`,size:`large`,class:`action-btn`,onClick:me,block:``},{icon:m(()=>[...o[7]||=[r(`ğŸ¤”`,-1)]]),default:m(()=>[o[8]||=r(` ä¸è®¤è¯† `,-1)]),_:1}),l(u,{type:`success`,size:`large`,class:`action-btn`,onClick:$,block:``},{icon:m(()=>[...o[9]||=[r(`ğŸ’¡`,-1)]]),default:m(()=>[o[10]||=r(` è®¤è¯†å•¦ `,-1)]),_:1})]),c(`div`,z,[l(u,{plain:``,type:`default`,size:`small`,onClick:pe,disabled:W.value===0,style:{border:`none`,color:`var(--text-light)`}},{default:m(()=>[...o[11]||=[r(` â† ä¸Šä¸€ä¸ª `,-1)]]),_:1},8,[`disabled`]),l(u,{plain:``,type:`default`,size:`small`,onClick:Z,style:{border:`none`,color:`var(--text-light)`}},{default:m(()=>[...o[12]||=[r(` è·³è¿‡ â†’ `,-1)]]),_:1})]),c(`div`,B,[l(w,{percentage:ue.value,"show-pivot":!1,"stroke-width":`6`,color:`var(--primary-color)`,"track-color":`#f0f2f5`},null,8,[`percentage`]),c(`div`,V,` è¿›åº¦: `+d(U.value.length?W.value+1:0)+` / `+d(U.value.length),1)])],2)):(f(),v(`div`,ie,[l(y,{image:Y.value?`default`:`search`,description:Y.value?`å¾…å¤ä¹ çš„å•è¯éƒ½å­¦å®Œå•¦`:`è¿˜æ²¡æœ‰å•è¯å“¦ï¼Œå¿«å»æ·»åŠ å§`},{bottom:m(()=>[c(`div`,ae,[Y.value?(f(),n(u,{key:0,plain:``,type:`primary`,round:``,block:``,onClick:_e,class:`mb-16`},{default:m(()=>[...o[1]||=[r(` é‡ç½®è¿›åº¦ (é‡æ–°å­¦ä¹ ) `,-1)]]),_:1})):i(``,!0),l(u,{type:`primary`,round:``,block:``,to:`/words/manage`},{default:m(()=>[...o[2]||=[r(` å»æ·»åŠ æ–°å•è¯ `,-1)]]),_:1})])]),_:1},8,[`image`,`description`])]))]),_:1})])}}},[[`__scopeId`,`data-v-41003547`]]);export{H as default};