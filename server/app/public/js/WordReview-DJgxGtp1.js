import{A as e,C as t,E as n,G as r,H as i,I as a,J as o,K as s,Q as c,T as l,U as u,V as d,W as f,Y as p,_ as m,a as h,at as g,ct as _,d as v,et as y,i as b,it as x,j as S,l as C,m as w,p as T,q as E,tt as D,u as O,v as k,w as A,y as j}from"./vue-qqQgwo1J.js";import"./vendor-BZARPbSw.js";import{t as M}from"./index-DngR5WJL.js";import{i as N,n as P}from"./wordmemory-UTo84tZV.js";var F={name:`WordReview`,setup(){let e=a(),t=g([]),n=g(!0),r=g(``),i=g(`ABCDEFGHIJKLMNOPQRSTUVWXYZ`.split(``)),o=g(new Map),s=g(`all`),l=async()=>{try{let e=await P.getAll(),t=new Map;(e.data||[]).forEach(e=>{t.set(e.wordId._id||e.wordId,e)}),o.value=t}catch(e){console.error(`Failed to load progress:`,e),k(`加载进度失败`)}},d=async()=>{try{n.value=!0,t.value=(await N.getAll()).data||[],await l()}catch(e){console.error(`Failed to load words:`,e),k(`加载单词失败`)}finally{n.value=!1}},f=e=>{let t=o.value.get(e);return t?t.status:`unlearned`},p=e=>o.value.get(e),m=e=>{if(!e)return``;let t=new Date(e),n=new Date-t,r=Math.floor(n/(1e3*60*60*24));return r===0?`今天`:r===1?`昨天`:r<7?`${r}天前`:t.toLocaleDateString(`zh-CN`,{month:`2-digit`,day:`2-digit`})},h=u(()=>{let e=r.value.trim().toLowerCase(),n=[...t.value];return s.value!==`all`&&(n=n.filter(e=>f(e._id)===s.value)),e&&(n=n.filter(t=>{let n=(t.word||``).toLowerCase(),r=(t.meaning||``).toLowerCase();return n.includes(e)||r.includes(e)})),n.sort((e,t)=>(e.word||``).localeCompare(t.word||``,`en`,{sensitivity:`base`}))}),_=u(()=>{let e={};return[...i.value,`#`].forEach(t=>{e[t]=[]}),h.value.forEach(t=>{let n=t.word?.charAt(0)||``;e[/^[a-zA-Z]/.test(n)?n.toUpperCase():`#`].push(t)}),[...i.value,`#`].map(t=>({letter:t,items:e[t]||[]})).filter(e=>e.items.length>0)}),v=u(()=>_.value.map(e=>e.letter));return c(()=>{d()}),{words:t,loading:n,searchQuery:r,statusFilter:s,filteredWords:h,groupedWords:_,indexList:v,getWordStatus:f,getWordProgress:p,formatDate:m,deleteWord:async e=>{try{await T({title:`确认删除`,message:`删除后不可恢复，确定删除吗？`}),await N.delete(e),await d(),j(`删除成功`)}catch(e){e?.message!==`cancel`&&(console.error(`Failed to delete word:`,e),k(`删除单词失败`))}},jumpToLearn:t=>{e.push({path:`/words/learn`,query:{wordId:t}})},statusText:e=>e===`failed`?`需复习`:e===`passed`?`已掌握`:`未学习`,statusTagType:e=>e===`failed`?`danger`:e===`passed`?`success`:`primary`}}},I={class:`word-review word-layout`},L={class:`sticky-header`},R={class:`review-body`},z={class:`text-xs text-gray`},B={class:`cell-title`},V={class:`word-text`},H={class:`word-phonetic`},U={class:`word-meaning`},W={key:0,class:`word-meta`},G={key:0},K={key:1};function q(a,c,u,g,T,k){let j=C,M=h,N=l,P=A,F=n,q=S,J=w,Y=v,X=m,Z=e,Q=b,$=t,ee=O;return y(),E(`div`,I,[p(F,null,{default:x(()=>[p(j,{title:`单词列表`,fixed:``,"safe-area-inset-top":``}),f(`div`,L,[p(M,{modelValue:g.searchQuery,"onUpdate:modelValue":c[0]||=e=>g.searchQuery=e,placeholder:`搜索单词或释义`,clearable:``,background:`#fff`,shape:`round`},null,8,[`modelValue`]),p(P,{active:g.statusFilter,"onUpdate:active":c[1]||=e=>g.statusFilter=e,type:`card`,class:`filter-tabs`},{default:x(()=>[p(N,{title:`全部`,name:`all`}),p(N,{title:`需复习`,name:`failed`}),p(N,{title:`已掌握`,name:`passed`}),p(N,{title:`未学习`,name:`unlearned`})]),_:1},8,[`active`])])]),_:1}),f(`div`,R,[g.loading?(y(),r(q,{key:0,size:`24px`,type:`spinner`,class:`mt-12 text-center`})):g.words.length===0?(y(),r(J,{key:1,description:`暂无单词，快去添加吧`})):g.filteredWords.length===0?(y(),r(J,{key:2,description:`未找到匹配的单词`,image:`search`})):(y(),r(ee,{key:3,"index-list":g.indexList,sticky:!0,"sticky-offset-top":110},{default:x(()=>[(y(!0),E(i,null,D(g.groupedWords,e=>(y(),E(`div`,{key:e.letter},[p(Y,{index:e.letter},{default:x(()=>[o(_(e.letter)+` `,1),f(`span`,z,`(`+_(e.items.length)+`)`,1)]),_:2},1032,[`index`]),(y(!0),E(i,null,D(e.items,e=>(y(),r($,{key:e._id,clickable:``,onClick:t=>g.jumpToLearn(e._id)},{title:x(()=>[f(`div`,B,[f(`span`,V,_(e.word),1),f(`span`,H,_(e.phonetic),1),p(X,{size:`small`,type:g.statusTagType(g.getWordStatus(e._id)),plain:``},{default:x(()=>[o(_(g.statusText(g.getWordStatus(e._id))),1)]),_:2},1032,[`type`])])]),label:x(()=>[f(`div`,U,_(e.meaning),1),g.getWordProgress(e._id)?(y(),E(`div`,W,[g.getWordProgress(e._id).attempts>0?(y(),E(`span`,G,` 复习 `+_(g.getWordProgress(e._id).attempts)+` 次 `,1)):s(``,!0),g.getWordProgress(e._id).lastReviewed?(y(),E(`span`,K,` · 上次 `+_(g.formatDate(g.getWordProgress(e._id).lastReviewed)),1)):s(``,!0)])):s(``,!0)]),"right-icon":x(()=>[p(Q,{direction:`vertical`,size:`6`},{default:x(()=>[p(Z,{size:`mini`,type:`primary`,plain:``,onClick:d(t=>g.jumpToLearn(e._id),[`stop`])},{default:x(()=>[...c[2]||=[o(` 去学习 `,-1)]]),_:1},8,[`onClick`]),p(Z,{size:`mini`,type:`danger`,plain:``,onClick:d(t=>g.deleteWord(e._id),[`stop`])},{default:x(()=>[...c[3]||=[o(` 删除 `,-1)]]),_:1},8,[`onClick`])]),_:2},1024)]),_:2},1032,[`onClick`]))),128))]))),128))]),_:1},8,[`index-list`]))])])}var J=M(F,[[`render`,q],[`__scopeId`,`data-v-e38af6dc`]]);export{J as default};